!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){var c=a("./Manager");b.exports=ng.Base.extend({viewCtx:null,worldCtx:null,vacuumCtx:null,tLoop:null,paused:!1,start:function(a){this.cview=a.viewport,this.cworld=a.world,this.cvacuum=a.vacuum,this.boundGameRun=this.gameRun.bind(this),this.initContexts(),this.manager=new c},initContexts:function(){function a(a,b){return a.width=b.x,a.height=b.y,a.getContext("2d")}var b=config.size,c=config.vacuum.size;this.viewCtx=a(this.cview,b),this.worldCtx=a(this.cworld,b),this.vacuumCtx=a(this.cvacuum,c)},loop:function(){this.manager.update(),this.manager.draw(this.viewCtx,this.worldCtx,this.vacuumCtx)},play:function(){this.paused=!1,Controls.enable(),this.gameRun()},stop:function(){this.paused=!0,Controls.disable(),window.cancelAnimationFrame(this.tLoop)},gameRun:function(){Time.tick()&&this.loop(),this.tLoop=window.requestAnimationFrame(this.boundGameRun)},onWin:function(a){this._onWin=a},onLoose:function(a){this._onLoose=a}})},{"./Manager":3}],2:[function(a,b){b.exports=ng.Base.extend({lastTime:null,frameTime:0,deltaTime:0,typicalFrameTime:20,minFrameTime:12,time:0,start:function(){this.lastTime=Date.now()},tick:function(){var a=Date.now(),b=a-this.lastTime;return b<this.minFrameTime?!1:(this.frameTime=b>2*this.typicalFrameTime?this.typicalFrameTime:b,this.deltaTime=this.frameTime/1e3,this.time+=this.frameTime,this.lastTime=a,!0)}})},{}],3:[function(a,b){b.exports=ng.Base.extend({start:function(){this.cursor=new prefabs.Cursor,this.nodes=new prefabs.Nodes,this.paths=new prefabs.Paths,this.target=new prefabs.Target,this.vacuum=new prefabs.Vacuum({target:this.target}),this.elements=new prefabs.Elements,this.spiders=new prefabs.Spiders({nodes:this.nodes}),this.stats=new prefabs.Stats,this.target.setNodesInside(this.nodes.getNodes())},update:function(){var a=this.cursor,b=this.nodes,c=this.spiders,d=this.elements;a.update(),d.current=a.element,d.active=a.active,b.applyPos=null,a.active&&(b.applyPos=a.pos,b.applyRatio=a.radius,b.element=a.element),b.update(),c.update(),this.target.update(c.getSpiders()),this.vacuum.update(),this.stats.update(c.stats),d.update()},draw:function(a,b,c){var d=config.size,e=config.vacuum.size;a.clearRect(0,0,d.x,d.y),b.clearRect(0,0,d.x,d.y),c.clearRect(0,0,e.x,e.y),this.cursor.draw(a),this.nodes.draw(b),this.spiders.draw(b),this.target.draw(b),this.vacuum.draw(c),this.stats.draw(a),this.elements.draw(a)}})},{}],4:[function(a){function b(){function a(a){return Math.max(b["client"+a],c["scroll"+a],b["scroll"+a],c["offset"+a],b["offset"+a])}var b=f.documentElement,c=f.body,d=a("Width"),e=a("Height"),g={x:1250,y:750},h={x:d>g.x?g.x:d,y:e>g.y?g.y:e},i=f.getElementById("game-ctn");return i.style.width=h.x+"px",i.style.height=h.y+"px",{size:h,world:{margin:{x:150,y:20}},vacuum:{size:{x:300,y:500}},images:{spider:"images/spider.png",elements:"images/elements.png"}}}function c(){function a(a){g.style.display=a?"":"none"}function b(){game.paused?(a(),game.play()):(g.innerHTML='<div class="pause">Pause</div>',a(!0),game.stop())}var c=f.getElementById("game-viewport"),d=f.getElementById("game-world"),j=f.getElementById("vacuum");e._={pad:function(a,b){var c="0000000"+a;return c.substr(c.length-b)}},e.Time=new i,e.Controls=new prefabs.Controls({container:f.getElementById("game-ctn")}),e.game=new h({viewport:c,world:d,vacuum:j}),e.game.onWin(function(){g.innerHTML='<div class="finish">Win!</div>',a(!0),game.stop()}),e.game.onLoose(function(){g.innerHTML='<div class="finish">Loose!</div>',a(!0),game.stop()}),a(),e.Controls.on("pause",b)}function d(){e.config=b(),e.ng.Repo.addResources(e.config.images).onComplete(function(){c(),e.game.play()}).load()}var e=window,f=e.document,g=document.querySelector(".bg-modal");a("./reqAnimFrame"),a("./ng"),e.prefabs=a("./prefabs");var h=a("./Game"),i=a("./GameTime");e.onload=d},{"./Game":1,"./GameTime":2,"./ng":9,"./prefabs":32,"./reqAnimFrame":33}],5:[function(a,b){var c={},d=0;c.uniqueId=function(a){var b=++d+"";return a?a+b:b},c.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},c.extend=function(a){if(!c.isObject(a))return a;for(var b,d,e=1,f=arguments.length;f>e;e++){b=arguments[e];for(d in b)hasOwnProperty.call(b,d)&&(a[d]=b[d])}return a};var e=b.exports=function(a){c.isObject(a)&&c.extend(this,a||{}),this.cid=c.uniqueId("c"),this.start.apply(this,arguments)};c.extend(e.prototype,{start:function(){}}),e.extend=function(a,b){var d=this,e=function(){return d.apply(this,arguments)};c.extend(e,d,b);var f=function(){this.constructor=e};return f.prototype=d.prototype,e.prototype=new f,a&&c.extend(e.prototype,a),e._super=d.prototype,e}},{}],6:[function(a,b){b.exports=ng.Base.extend({entities:[],start:function(){this.entities=[]},update:function(){this.entities.forEach(function(a){a.update()})},draw:function(a){this.entities.forEach(function(b){b.draw(a)})}})},{}],7:[function(a,b){b.exports=ng.Base.extend({pos:{x:0,y:0},start:function(){},update:function(){},draw:function(){}})},{}],8:[function(a,b){b.exports=ng.Entity.extend({resource:"",pos:{x:0,y:0},sprite:{x:0,y:0,w:20,h:20},size:{x:20,y:20},angle:0,start:function(){},update:function(){},draw:function(a){ng.Renderer.drawSprite(a,{resource:this.resource,pos:this.pos,size:this.size,angle:this.angle,sp:this.sprite})}})},{}],9:[function(a){var b=window.ng={};b.Base=a("./Base"),b.Entity=a("./Entity"),b.Collection=a("./Collection"),b.Mathf=a("./util/Mathf"),b.Color=a("./util/Color"),b.Vector=a("./util/Vector"),b.Renderer=a("./util/Renderer"),b.Repo=a("./util/Repo"),b.Circle=a("./shapes/Circle"),b.Line=a("./shapes/Line"),b.Rect=a("./shapes/Rect"),b.Text=a("./shapes/Text"),b.Sprite=a("./Sprite")},{"./Base":5,"./Collection":6,"./Entity":7,"./Sprite":8,"./shapes/Circle":10,"./shapes/Line":11,"./shapes/Rect":12,"./shapes/Text":13,"./util/Color":14,"./util/Mathf":15,"./util/Renderer":16,"./util/Repo":17,"./util/Vector":18}],10:[function(a,b){b.exports=ng.Entity.extend({pos:{x:0,y:0},radius:5,stroke:null,start:function(){},update:function(){},draw:function(a){var b={pos:this.pos,radius:this.radius,lineCap:this.lineCap||"butt"};this.color&&(b.fill=ng.Color.toRGBA(this.color)),this.stroke&&(b.stroke=this.stroke),this.angles&&(b.angles=this.angles),ng.Renderer.drawCircle(a,b)}})},{}],11:[function(a,b){b.exports=ng.Entity.extend({pos:{x:0,y:0},to:{x:0,y:0},size:1,color:ng.Color.white,start:function(){},update:function(){},draw:function(a){ng.Renderer.drawLine(a,{from:this.pos,to:this.to,size:this.size,color:ng.Color.toRGBA(this.color)})}})},{}],12:[function(a,b){b.exports=ng.Entity.extend({pos:{x:0,y:0},size:{x:20,y:20},fill:null,stroke:null,corner:null,start:function(){},update:function(){},draw:function(a){var b={pos:this.pos,size:this.size};this.stroke&&(b.stroke=this.stroke,b.stroke.color&&(b.stroke.color=ng.Color.toRGBA(b.stroke.color))),this.fill&&(b.fill=ng.Color.toRGBA(this.fill)),this.corner&&(b.corner=this.corner),ng.Renderer.drawRect(a,b)}})},{}],13:[function(a,b){b.exports=ng.Entity.extend({pos:{x:0,y:0},text:"",size:1,color:ng.Color.white,start:function(){},update:function(){},draw:function(a){ng.Renderer.drawText(a,{text:this.text,pos:this.pos,size:this.size,color:ng.Color.toRGBA(this.color)})}})},{}],14:[function(a,b){b.exports=ng.Base.extend({},{white:[255,255,255,1],toRGBA:function(a){return"rgba("+a[0]+","+a[1]+","+a[2]+","+(a[3]||1)+")"},lerp:function(a,b,c){function d(a,b,c,d){return d=d?d:1,Math.round(ng.Mathf.lerp(a,b,c)*d)/d}return[d(a[0],b[0],c),d(a[1],b[1],c),d(a[2],b[2],c),d(a[3]>=0?a[3]:1,b[3]>=0?b[3]:1,c,100)]},eql:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}})},{}],15:[function(a,b){var c=b.exports=ng.Base.extend({},{rnd:function(a,b){return Math.floor(Math.random()*(b-a+1)+a)},rnd01:function(){return Math.random()},rndInCircle:function(a){var b=Math.random()*Math.PI*2,d=c.rnd(0,a);return{x:Math.cos(b)*d,y:Math.sin(b)*d}},lerp:function(a,b,c){return(1-c)*a+c*b},polygonPoints:function(a,b,c){for(var d=[],e=2*Math.PI/c,f=0;c>f;f++)d.push({x:a.x+b*Math.cos(f*e),y:a.y+b*Math.sin(f*e)});return d}})},{}],16:[function(a,b){function c(a,b){b.hasOwnProperty("fill")&&(a.fillStyle=b.fill,a.fill())}function d(a,b){if(b.hasOwnProperty("stroke")){a.lineWidth=b.strokeWidth||b.stroke.size||1;var c=b.stroke.color||b.stroke||"#000";a.strokeStyle=Array.isArray(c)?ng.Color.toRGBA(c):c,a.stroke()}}function e(a,b){a.beginPath(),a.rect(b.pos.x,b.pos.y,b.size.x,b.size.y),c(a,b),d(a,b)}b.exports=ng.Base.extend({},{drawCircle:function(a,b){var e=b.angles&&b.angles.start||0,f=b.angles&&b.angles.end||2*Math.PI;a.beginPath(),b.lineCap&&(a.lineCap=b.lineCap),a.arc(b.pos.x,b.pos.y,b.radius,e,f,!1),c(a,b),d(a,b)},drawLine:function(a,b){var c=b.from,d=b.to;a.beginPath(),a.lineCap="round",a.moveTo(c.x,c.y),a.lineTo(d.x,d.y),a.lineWidth=b.size,a.strokeStyle=b.color,a.stroke()},drawSprite:function(a,b){function c(){j?a.drawImage(d,j.x,j.y,j.w,j.h,f,g,h,i):a.drawImage(d,f,g,h,i)}var d=ng.Repo[b.resource],e=ng.Vector.origin(b.pos,b.size),f=e.x,g=e.y,h=b.size.x,i=b.size.y,j=b.sp;return b.hasOwnProperty("angle")?(a.save(),a.translate(f+h/2,g+i/2),f=-h/2,g=-i/2,a.rotate(b.angle),c(),void a.restore()):void c()},drawText:function(a,b){a.font=b.size+"pt Arial",a.textBaseline=b.baseline||"middle",a.fillStyle=b.color,a.fillText(b.text,b.pos.x,b.pos.y)},drawRect:function(a,b){var f=b.pos.x,g=b.pos.y,h=b.size.x,i=b.size.y;if(!b.hasOwnProperty("corner"))return void e(a,b);var j=b.corner;a.beginPath(),a.moveTo(f+j,g),a.lineTo(f+h-j,g),a.quadraticCurveTo(f+h,g,f+h,g+j),a.lineTo(f+h,g+i-j),a.quadraticCurveTo(f+h,g+i,f+h-j,g+i),a.lineTo(f+j,g+i),a.quadraticCurveTo(f,g+i,f,g+i-j),a.lineTo(f,g+j),a.quadraticCurveTo(f,g,f+j,g),a.closePath(),c(a,b),d(a,b)}})},{}],17:[function(a,b){b.exports=function(){var a={},b=0,c=function(){return Object.keys(a).length},d=function(){},e=function(){var a=c(),e=100*++b/a;a>=b&&e>=100&&d()};return{onComplete:function(a){return d=a,this},load:function(){b=0;for(var c in a)this[c]=new window.Image,this[c].onload=e,this[c].src=a[c];return this},addResources:function(b){for(var c in b)a[c]=b[c];return this}}}()},{}],18:[function(a,b){var c=b.exports=ng.Base.extend({},{zero:{x:0,y:0},one:{x:1,y:1},clone:function(a){return{x:a.x,y:a.y}},prod:function(a,b){return{x:a.x*b.x,y:a.y*b.y}},multiply:function(a,b){return{x:a.x*b,y:a.y*b}},divide:function(a,b){return{x:a.x/b,y:a.y/b}},add:function(a,b){return{x:a.x+b.x,y:a.y+b.y}},dif:function(a,b){return{x:b.x-a.x,y:b.y-a.y}},part:function(a,b,d){return c.lerp(a,b,d/10)},angleTo:function(a,b){var d=c.dif(a,b);return Math.atan2(d.y,d.x)},mid:function(a,b){return c.divide(c.add(a,b),2)},eql:function(a,b){return a.x===b.x&&a.y===b.y},normal:function(a,b){var d=c.dif(a,b),e=c.magnitude(a,b);return{x:d.x/e||0,y:d.y/e||0}},origin:function(a,b){return{x:a.x-b.x/2,y:a.y-b.y/2}},center:function(a,b){return{x:a.x+b.x/2,y:a.y+b.y/2}},magnitude:function(a,b){var d=c.dif(a,b);return Math.sqrt(d.x*d.x+d.y*d.y)},pointInCircle:function(a,b,d){return c.magnitude(a,b)<d},lerp:function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}},round:function(a){return a.x=Math.round(a.x),a.y=Math.round(a.y),a},isOut:function(a,b,c){return a.x<b.x||a.x>c.x||a.y<b.y||a.y>c.y}})},{}],19:[function(a,b){function c(a,b){var c,d,e=document,f=e.body,g=e.documentElement;return a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(c=a.clientX+f.scrollLeft+g.scrollLeft,d=a.clientY+f.scrollTop+g.scrollTop),c-=b.offsetLeft,d-=b.offsetTop,{x:c,y:d}}b.exports=ng.Base.extend({events:{pressing:null,moving:null,release:null,element:null,pause:null},enabled:!1,start:function(a){var b=window.document,c=this.container=a.container||b;c.onmouseup=this._onMouseEvent.bind(this,"release"),c.onmousedown=this._onMouseEvent.bind(this,"pressing"),c.onmousemove=this._onMouseEvent.bind(this,"moving"),b.onkeyup=this._onKeyUp.bind(this)},enable:function(){return this.enabled=!0,this},disable:function(){return this.enabled=!1,this},on:function(a,b){return this.events[a]||(this.events[a]=[]),this.events[a].push(b),this},off:function(a){return this.events[a]&&(this.events[a].length=0),this},_getEventName:function(a){switch(a.which||a.keyCode){case 81:case 113:return"element:fire";case 87:case 119:return"element:water";case 69:case 101:return"element:earth";case 82:case 114:return"element:air";case 112:case 80:return"pause"}},_onKeyUp:function(a){var b=this._getEventName(a);if((this.enabled||"pause"===b)&&b){if(b.indexOf("element")>-1){var c=b.split(":")[1];return void this.events.element.forEach(function(a){a(c)})}this.events[b].forEach(function(a){a()})}},_onMouseEvent:function(a,b){if(this.enabled){var d=c(b,this.container);this.events[a].forEach(function(a){a(d)})}}})},{}],20:[function(a,b){b.exports=ng.Circle.extend({radius:20,stroke:{color:"#fff",size:2},active:!1,element:"fire",start:function(){Controls.on("pressing",this.onPressing.bind(this)),Controls.on("moving",this.onMoving.bind(this)),Controls.on("release",this.onRelease.bind(this)),Controls.on("element",this.onElement.bind(this))},onPressing:function(a){this.pos=a,this.active=!0},onMoving:function(a){this.pos=a},onRelease:function(){this.active=!1},onElement:function(a){this.element=a},update:function(){var a=["fire","water","earth","air"],b=.4,c=[20,20,20,50],d=[[255,0,0,b],[0,0,255,b],[165,140,80,b],[0,220,255,b]];this.color=d[a.indexOf(this.element)],this.radius=c[a.indexOf(this.element)]}})},{}],21:[function(a,b){b.exports=ng.Collection.extend({size:{x:96,y:96},start:function(a){this.entities=[],this.name=a.name,this.key=a.key,this.color=[255,255,255,1],this.sprite=a.sprite,this.active=!1,this.current=!1,this.createElement()},createElement:function(){this.bg=new ng.Rect({pos:this.pos,size:this.size,fill:this.color,stroke:{size:4,color:[30,30,30,1]},corner:8}),this.entities.push(this.bg),this.icon=new ng.Sprite({resource:"elements",pos:ng.Vector.center(this.pos,this.size),size:this.size,angle:0,sprite:this.sprite}),this.entities.push(this.icon);var a={x:this.pos.x,y:this.pos.y+1.1*this.size.y},b=20;this.ctrlKey=new ng.Rect({pos:{x:a.x-b/2,y:a.y-b},size:ng.Vector.multiply(ng.Vector.one,2*b),fill:[0,0,0,1],corner:4}),this.entities.push(this.ctrlKey),this.txtKey=new ng.Text({text:this.key,pos:a,size:b,color:[255,255,255,1]}),this.entities.push(this.txtKey)},update:function(){this.bg.fill=this.active?[255,255,255,1]:[255,255,255,.1],this.bg.stroke.color=this.current?[255,255,255,1]:[0,0,0,1]}})},{}],22:[function(a,b){b.exports=ng.Collection.extend({pos:{x:20,y:50},start:function(){this.entities=[],this.current="fire",this.active=!1,this.keys=["Q","W","E","R"],this.elements=["fire","water","earth","air"],this.sprites={};for(var a=0;4>a;a++)this.sprites[this.elements[a]]={x:32*a,y:0,w:32,h:32};this.createElements()},createElements:function(){var a=50,b=96;this.elements.forEach(function(c,d){this.entities.push(new prefabs.Element({pos:{x:this.pos.x,y:this.pos.y+d*(b+a)},name:c,key:this.keys[d],sprite:this.sprites[c]}))},this)},update:function(){var a=this.active,b=this.current;this.entities.forEach(function(c){c.active=c.current=!1,c.name===b&&(c.current=!0,c.active=a),c.update()})}})},{}],23:[function(a,b){b.exports=ng.Circle.extend({radius:3,color:ng.Color.white,nears:null,selected:!1,temp:0,incTemp:0,incTempSize:0,burned:!1,shaked:!1,originalPos:null,hasEarth:!1,insideTarget:!1,blowing:!1,blowingEnd:0,colors:{cold:[255,255,255,1],burn:[255,0,0,1],burned:[0,0,0,.2],earth:[190,160,40,1]},start:function(){this.nears=[]},addNear:function(a){this.nears.push(a)},randomBurn:function(){var a=this.nears.some(function(a){return a.burned});!a&&ng.Mathf.rnd01()<.15&&this.setBurned()},getNearBurned:function(){var a;return this.nears.some(function(b){return b.burned?(a=b,!0):void 0}),a},shake:function(){this.originalPos?this.pos=this.originalPos:this.originalPos=this.pos,this.shaked=!0,this.pos=ng.Vector.round(ng.Vector.add(this.pos,ng.Mathf.rndInCircle(.2)))},endShake:function(){this.originalPos&&(this.pos=this.originalPos),this.shaked=!1},revive:function(){this.burned&&(this.resetTemp(),this.burned=!1)},burn:function(){this.burned||(this.incTemp=1)},cool:function(){this.burned||(this.incTemp=-1,this.incTempSize=.5)},applyEarth:function(){this.burned||(this.hasEarth=!0)},applyAir:function(){this.burned||(this.blowing=!0,this.hasEarth=!1,this.blowingEnd=Time.time+500)},getRandomNear:function(a){var b=[];if(this.nears.forEach(function(c){c.cid!==a&&!c.burned&&c.temp<.5&&b.push(c)}),b.length>0){var c=ng.Mathf.rnd(0,b.length-1);return b[c]}return null},resetTemp:function(){this.temp=0,this.incTemp=0,this.incTempSize=0},setBurned:function(){this.burned=!0,this.fill=this.color=this.colors.burned,this.resetTemp()},update:function(){if(!this.burned){if(this.blowing&&Time.time>this.blowingEnd&&(this.blowing=!1),this.hasEarth)return this.fill=this.color=this.colors.earth,void this.resetTemp();var a=this.nears.every(function(a){return a.burned});return a?void this.setBurned():(this.incTemp>0&&(this.incTempSize=this.blowing?.2:.1),this.blowing||this.insideTarget?this.shake():this.shaked&&this.endShake(),this.temp+=this.incTemp*this.incTempSize*Time.deltaTime,this.temp<=0&&this.resetTemp(),this.fill=this.color=ng.Color.lerp(this.colors.cold,this.colors.burn,this.temp),this.temp>1?(this.setBurned(),void this.resetTemp()):void 0)}}})},{}],24:[function(a,b){var c=b.exports=ng.Collection.extend({paths:null,applyPos:null,applyRatio:0,element:null,start:function(){this.paths=new prefabs.Paths;var a=config.world.margin.x,b=config.world.margin.y,c=ng.Vector.divide(config.size,2);c.x-=a,c.y-=b;var d=ng.Vector.center(ng.Vector.zero,config.size);this.createWeb(d,c)},createWeb:function(a,b){var c=0,d=30,e=d/5,f=6,g=3,h=2,i=8*f,j=ng.Vector.add(a,ng.Vector.multiply(b,-1)),k=ng.Vector.add(a,b),l=[],m=new prefabs.Node({pos:a});this.entities.push(m);var n,o=10,p=1,q=0;do{n=!1,p%g===0&&(f*=h),f>i&&(f=i);var r=ng.Mathf.polygonPoints(a,p*d+o,f);q+=r.length;var s=[];(10===p||20===p)&&(e+=.1),r.forEach(function(a){var b=ng.Vector.round(ng.Vector.add(a,ng.Mathf.rndInCircle(e))),c=new prefabs.Node({pos:b});ng.Vector.isOut(b,j,k)?c.out=!0:(n=!0,this.entities.push(c)),s.push(c)},this),l[p-1]=s,p++}while(n);c=p-2,l[0].forEach(function(a){this.paths.addOne(m,a)},this);var t,u,v,w;for(t=0;c>t;t++){var x=l[t],y=x.length;for(u=0;y>u;u++){v=u+1,w=u*h,v>y-1&&(v=0),w>y*h-g&&(w=-h);var z=l[t][v];if(!z.out){var A=l[t+1],B=A[v];A.length>x.length&&(B=A[w+h]),c-1>t&&B&&!B.out&&this.paths.addOne(z,B);var C=l[t][u];C.out||this.paths.addOne(z,C)}}}this.entities.forEach(function(a){a.randomBurn()})},elements:["fire","water","earth","air"],applyMethods:["burn","cool","applyEarth","applyAir"],findNodeByCollider:function(){this.entities.forEach(function(a){if(this.applyPos&&ng.Vector.pointInCircle(this.applyPos,a.pos,this.applyRatio)){var b=this.elements.indexOf(this.element),c=this.applyMethods[b];a[c]()}},this)},getNodes:function(){return this.entities},update:function(){this.applyPos&&this.findNodeByCollider(),this.paths.update(),c._super.update.apply(this)},draw:function(a){this.paths.draw(a),c._super.draw.apply(this,arguments)}})},{}],25:[function(a,b){var c=b.exports=ng.Line.extend({pos:{x:0,y:0},to:{x:0,y:0},size:2,color:ng.Color.white,tBurn:.5,burned:!1,heat:null,na:null,nb:null,setHeat:function(a,b,c){this.heat={from:a.pos,to:ng.Vector.round(ng.Vector.lerp(a.pos,b.pos,2*c>1?1:2*c))}},update:function(){var a=this.na,b=this.nb,c=a.temp,d=b.temp,e=a.color,f=this.nb.color;c>0?this.setHeat(a,b,c):d>0&&this.setHeat(b,a,d),c>this.tBurn&&0===d?b.burn():d>this.tBurn&&0===c&&a.burn(),this.color=ng.Color.eql(e,f)?e:ng.Color.lerp(e,f,this.tBurn),(a.burned||b.burned)&&(this.heat=null,this.burned=!0,this.color=[0,0,0,.2]),this.pos=this.na.pos,this.to=this.nb.pos},draw:function(a){c._super.draw.apply(this,arguments),this.heat&&ng.Renderer.drawLine(a,{from:this.heat.from,to:this.heat.to,size:5,color:"rgba(255,0,0,0.4)"})}})},{}],26:[function(a,b){b.exports=ng.Collection.extend({hasOne:function(a,b){return this.entities.some(function(c){var d=c.na.cid,e=c.nb.cid;return!(a!==d&&a!==e||b!==d&&b!==e)})},addOne:function(a,b){b&&!this.hasOne(a.cid,b.cid)&&(a.addNear(b),b.addNear(a),this.entities.push(new prefabs.Path({na:a,nb:b})))}})},{}],27:[function(a,b){var c=b.exports=ng.Sprite.extend({resource:"spider",size:{x:32,y:32},nFrom:null,nTo:null,journeyLength:null,traveling:!1,isDead:!1,temp:0,staying:!1,t_stay:2e3,t_startStay:0,t_nextStay:0,t_startMove:0,building:!1,spriteIndex:0,animTime:3,lastFrameTime:0,exited:!1,calmSpeed:.05,alertSpeed:.1,behaviour:{alertTemp:0,tStayA:3e3,tStayB:1e4},start:function(a){this.pos=ng.Vector.round(a.pos),this.onDead=a.onDead,this.speed=this.calmSpeed,this.move=[];for(var b=0;4>b;b++)this.move.push({x:32*b,y:0,w:32,h:32});this.sprite=this.move[0]},setNode:function(a,b){this.nFrom=a,this.nTo=b,this.t_startMove=Time.time,this.journeyLength=ng.Vector.magnitude(a.pos,b.pos),this.traveling=!0,this.angle=ng.Vector.angleTo(this.pos,this.nTo.pos)},setDead:function(){this.isDead||(this.isDead=!0,this.onDead())},animate:function(){this.staying||(this.lastFrameTime-=Time.frameTime,this.lastFrameTime<=0&&(this.spriteIndex++,this.spriteIndex>3&&(this.spriteIndex=0),this.lastFrameTime=this.animTime/this.speed))},updateTemp:function(){var a=this.nFrom.temp,b=this.nTo.temp;return 0===a&&0===b?void(this.temp=0):a>b?void(this.temp=a):void(b>a&&(this.temp=b))},canMove:function(){return!this.staying&&!this.traveling&&!this.building},updateState:function(){var a=Time.time,b=this.behaviour,c=this.t_startStay,d=this.t_stay;return this.temp>b.alertTemp?(this.speed=this.alertSpeed,void(this.staying=!1)):(this.speed=this.calmSpeed,void(this.staying?a>c+d&&(this.staying=!1,this.t_nextStay=a+d/ng.Mathf.rnd(2,5)):a>this.t_nextStay&&ng.Mathf.rnd01()<.8&&(this.staying=!0,this.t_startStay=a,this.t_stay=ng.Mathf.rnd(b.tStayA,b.tStayB))))},updateMove:function(){if(!this.building&&(this.nFrom.burned||this.nTo.burned))return void this.setDead();var a=(Time.time-this.t_startMove)*this.speed,b=a/this.journeyLength;return b>1?(this.pos=this.nTo.pos,this.nTo.revive(),this.traveling=!1,this.building=!1,!0):(this.pos=ng.Vector.round(ng.Vector.lerp(this.nFrom.pos,this.nTo.pos,b)),void this.animate())},buildWeb:function(a,b){this.building=!0,this.traveling=!0,this.setNode(a,b)},update:function(){if(this.sprite=this.move[this.spriteIndex],!(this.isDead||this.exited||this.inVacuum)){if(this.updateTemp(),this.building||this.traveling){var a=this.updateMove();if(!a)return}this.updateState()}},draw:function(a){this.isDead||(this.building&&ng.Renderer.drawLine(a,{from:this.pos,to:this.nFrom.pos,size:2,color:ng.Color.toRGBA(ng.Color.white)}),c._super.draw.apply(this,arguments))}})},{}],28:[function(a,b){b.exports=ng.Collection.extend({nodes:null,spidersExit:0,spidersKilled:0,stats:{},amount:50,start:function(a){this.entities=[],this.nodes=a.nodes,this.onExitSpider=a.onExitSpider,this.generateSpiders(),this.updateGUI()},updateGUI:function(){this.stats={saved:this.spidersExit,killed:this.spidersKilled,alives:this.entities.length-(this.spidersKilled+this.spidersExit),total:this.entities.length}},onSpiderDead:function(){this.spidersKilled++,this.updateGUI()},generateSpiders:function(){var a,b,c=this.nodes.getNodes(),d=c.length,e=[],f=d<this.amount?d-2:this.amount;do b=ng.Mathf.rnd(0,d-1),a=c[b],a.burned||-1!==e.indexOf(a.cid)||(e.push(a.cid),this.entities.push(new prefabs.Spider({pos:a.pos,onDead:this.onSpiderDead.bind(this)})),f--);while(f)},getSpiders:function(){return this.entities},gonnaBuildWeb:function(a,b){if(!a.hasEarth&&0===a.temp&&ng.Mathf.rnd01()>.7){var c=a.getNearBurned();if(c)return b.buildWeb(a,c),!0}return!1},gotNearNodeToGo:function(a,b){var c=b.nodeFrom&&b.nodeFrom.cid||-1,d=a.getRandomNear(c);return d?(b.setNode(a,d),!0):!1},spiderNodeCollide:function(a,b){ng.Vector.pointInCircle(a.pos,b.pos,5)&&(this.gonnaBuildWeb(b,a)||this.gotNearNodeToGo(b,a)||b.burned&&a.setDead())},update:function(){var a=this.nodes.getNodes(),b=this.spidersExit;this.spidersExit=0,this.entities.forEach(function(b){b.exited?this.spidersExit++:b.canMove()&&a.some(function(a){this.spiderNodeCollide(b,a)},this),b.update()},this),b!==this.spidersExit&&this.updateGUI()},draw:function(a){this.entities.forEach(function(b){b.inVacuum||b.draw(a)})}})},{}],29:[function(a,b){b.exports=ng.Collection.extend({pos:{x:1,y:0},marginW:40,marginH:40,colors:{kills:[255,0,0,1],alives:[0,255,0,1]},start:function(){this.entities=[],this.pos=ng.Vector.prod(this.pos,config.size),this.stats={saved:0,killed:0,alives:0,total:0},this.createIcons(),this.createText()},createIcons:function(){var a=40,b=this.marginW,c=this.marginH,d={x:a,y:a},e={x:a/2,y:a/2},f={resource:"spider",sprite:{x:0,y:0,w:32,h:32},size:d,angle:Math.PI/2};f.pos={x:this.pos.x-b,y:this.pos.y+c+1.5*a},this.iconAlives=new ng.Sprite(f),this.entities.push(this.iconAlives),f.pos={x:this.pos.x-b,y:this.pos.y+c},this.iconKills=new ng.Sprite(f),this.entities.push(this.iconKills),this.lineAKills=new ng.Line({pos:ng.Vector.origin(f.pos,d),to:ng.Vector.add(e,f.pos),size:3,color:this.colors.kills}),this.entities.push(this.lineAKills),this.lineBKills=new ng.Line({pos:{x:f.pos.x+e.x,y:f.pos.y-e.y},to:{x:f.pos.x-e.x,y:f.pos.y+e.y},size:3,color:this.colors.kills}),this.entities.push(this.lineBKills)},createText:function(){var a=30;this.textKills=new ng.Text({pos:{x:this.iconKills.pos.x-3*a,y:this.iconKills.pos.y},size:a,color:this.colors.kills}),this.entities.push(this.textKills),this.textAlives=new ng.Text({pos:{x:this.iconAlives.pos.x-3*a,y:this.iconAlives.pos.y},size:a,color:this.colors.alives}),this.entities.push(this.textAlives)},update:function(a){this.stats=a,this.textKills.text=_.pad(this.stats.killed,3),this.textAlives.text=_.pad(this.stats.alives,3)}})},{}],30:[function(a,b){b.exports=ng.Circle.extend({stroke:{color:[80,255,85,.1]},angles:{start:.97*Math.PI,end:1.52*Math.PI},lineCap:"butt",suckForce:3,start:function(){var a=config,b=a.world.margin;this.size=a.size.y/6,this.radius=this.size/2,this.stroke.size=this.size,this.pos=ng.Vector.prod(ng.Vector.one,a.size),this.pos.x-=b.x+10,this.pos.y-=b.y+20,this.saved=[],this.saving=[]},setNodesInside:function(a){a.forEach(function(a){ng.Vector.pointInCircle(a.pos,this.pos,this.size)&&(a.burned&&(a.burned=!1,a.revive()),a.insideTarget=!0)},this)},update:function(a){a.forEach(function(a){a.dead||a.exited||ng.Vector.pointInCircle(a.pos,this.pos,this.size)&&(a.building=!1,a.exited=!0,a.vel={x:0,y:0},this.saving.push(a))},this);var b=Time.deltaTime,c=b*this.suckForce,d=this.pos;this.saving.forEach(function(a){if(!a.catched){var b=a.pos,e=ng.Vector.normal(b,d);a.vel=ng.Vector.add(a.vel,ng.Vector.multiply(e,c)),a.pos=ng.Vector.add(b,a.vel),ng.Vector.pointInCircle(a.pos,d,5)&&(a.catched=!0,this.saved.push(a))}},this)}})},{}],31:[function(a,b){b.exports=ng.Entity.extend({start:function(a){this.target=a.target,this.size=config.vacuum.size,this.targetLen=20,this.current=0,this.offx=30,this.offy=10,this.recipePos={x:this.offx+165,y:this.offy+65},this.recipeSize={x:80,y:300},this.createGraphics()},createGraphics:function(){var a={x:this.offx+150,y:this.offy+50};this.bgBack=new ng.Rect({pos:a,size:{x:110,y:330},corner:6,fill:[158,158,158],stroke:{color:[71,71,71],size:2}});var b=[187,187,249],c={pos:this.recipePos,size:this.recipeSize,corner:6,fill:ng.Color.white,stroke:{size:2,color:b}};this.cilinder=new ng.Rect(c),c.fill=[0,0,255,.5],this.glass=new ng.Rect(c),this.stats=new ng.Text({pos:{x:180,y:30},size:20,color:ng.Color.white})},update:function(){this.current=this.target.saved.length;var a=this.recipePos,b=this.recipeSize,c=a.y+b.y/2,d=a.x+b.x/2,e=2*Time.time*Math.PI;this.target.saved.forEach(function(a){if(a.inVacuum){a.animate();var b=a.vacuum;a.pos={x:b.ampX*Math.sin(e/b.velX)+d,y:b.ampY*Math.sin(e/b.velY)+c},a.angle+=b.rot}else a.inVacuum=!0,a.vacuum={ampY:ng.Mathf.rnd(10,c/2),velY:ng.Mathf.rnd(600,1e3),ampX:ng.Mathf.rnd(5,20),velX:ng.Mathf.rnd(2e3,6e3),rot:ng.Mathf.rnd(1,5)/10},a.pos={x:d,y:c}},this),this.stats.text=_.pad(this.current,3)+" / "+_.pad(this.targetLen,3)},draw:function(a){this.drawBG(a),this.cilinder.draw(a),this.target.saved.forEach(function(b){b.draw(a)}),this.glass.draw(a),this.stats.draw(a)},drawBG:function(a){function b(b,e,f){a.beginPath();var g=b[0];a.moveTo(c+g[0],d+g[1]);for(var h=1;h<b.length;h++){var i=b[h];4===i.length?a.quadraticCurveTo(c+i[0],d+i[1],c+i[2],d+i[3]):a.lineTo(c+i[0],d+i[1])}a.lineTo(c+g[0],d+g[1]),e&&(a.fillStyle=e,a.fill()),a.lineWidth=3,a.strokeStyle=f,a.lineCap="round",a.stroke(),a.closePath()}var c=this.offx,d=this.offy,e=[[70,460],[120,400],[160,445],[195,450,185,380],[225,380],[230,510,145,475]];b(e,"#9e9e9e","#474747"),this.bgBack.draw(a)}})},{}],32:[function(a,b){b.exports={Controls:a("./Controls"),Node:a("./Node"),Nodes:a("./Nodes"),Path:a("./Path"),Paths:a("./Paths"),Cursor:a("./Cursor"),Spider:a("./Spider"),Spiders:a("./Spiders"),Target:a("./Target"),Vacuum:a("./Vacuum"),Stats:a("./Stats"),Element:a("./Element"),Elements:a("./Elements")}},{"./Controls":19,"./Cursor":20,"./Element":21,"./Elements":22,"./Node":23,"./Nodes":24,"./Path":25,"./Paths":26,"./Spider":27,"./Spiders":28,"./Stats":29,"./Target":30,"./Vacuum":31}],33:[function(){!function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){window.clearTimeout(a)})}()},{}]},{},[4]);